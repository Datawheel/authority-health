const regionLookup = {
  48236: "04",
  48230: "04",
  48167: "10",
  48168: "10",
  48170: "10",
  48188: "21",
  48187: "21",
  48125: "02",
  48141: "02",
  48127: "02",
  48212: "09",
  48213: "09",
  48211: "09",
  48150: "26",
  48152: "26",
  48154: "26",
  48121: "06",
  48123: "06",
  48120: "06",
  48126: "06",
  48128: "06",
  48124: "06",
  48101: "01",
  48217: "01",
  48229: "01",
  48218: "01",
  48122: "01",
  48240: "24",
  48239: "24",
  48180: "18",
  48203: "13",
  48238: "13",
  48134: "25",
  48173: "25",
  48193: "25",
  48183: "25",
  48138: "25",
  48195: "08",
  48192: "08",
  48136: "27",
  48135: "27",
  48184: "27",
  48186: "27",
  48185: "27",
  48214: "16",
  48207: "16",
  48225: "07",
  48224: "07",
  48216: "03",
  48208: "03",
  48222: "03",
  48201: "03",
  48202: "03",
  48226: "03",
  48231: "03",
  48164: "12",
  48174: "12",
  48111: "12",
  48112: "12",
  48227: "19",
  48223: "14",
  48228: "14",
  48235: "23",
  48204: "11",
  48206: "11",
  48221: "22",
  48146: "17",
  48219: "20",
  48209: "05",
  48210: "05",
  48215: "16",
  48205: "15",
  48234: "15"
};

const zipLookup = {
  1: ["48101", "48217", "48229", "48218", "48122"],
  2: ["48125", "48141", "48127"],
  3: ["48216", "48208", "48222", "48201", "48202", "48226", "48231"],
  4: ["48236", "48230"],
  5: ["48209", "48210"],
  6: ["48121", "48123", "48120", "48126", "48128", "48124"],
  7: ["48225", "48224"],
  8: ["48195", "48192"],
  9: ["48212", "48213", "48211"],
  10:	["48167", "48168", "48170"],
  11:	["48204", "48206"],
  12:	["48164", "48174", "48111", "48112"],
  13:	["48203", "48238"],
  14:	["48223", "48228"],
  15:	["48205", "48234"],
  16:	["48214", "48207", "48215"],
  17:	["48146"],
  18:	["48180"],
  19:	["48227"],
  20:	["48219"],
  21:	["48188", "48187"],
  22:	["48221"],
  23:	["48235"],
  24:	["48240", "48239"],
  25:	["48134", "48173", "48193", "48183", "48138"],
  26:	["48150", "48152", "48154"],
  27:	["48136", "48135", "48184", "48186", "48185"]
};

const fs = require("fs");
const zipFile = "static/topojson/zipcodes.json";
const zipTopo = JSON.parse(fs.readFileSync(zipFile));
zipTopo.objects.mi_michigan_zip_codes_geo.geometries.forEach(d => {
  const region = regionLookup[d.properties.ZCTA5CE10];
  if (region) d.properties.REGION = `ZRXXXUS${region}`;
  else if (d.properties.REGION) delete d.properties.REGION;
});
zipTopo.objects.mi_michigan_zip_codes_geo.geometries = zipTopo.objects.mi_michigan_zip_codes_geo.geometries.filter(d => d.properties.REGION);
fs.writeFileSync(zipFile, JSON.stringify(zipTopo));

console.log("topomerge regions=mi_michigan_zip_codes_geo -f 'd.properties.REGION !== undefined' -k 'd.properties.REGION' < static/topojson/zipcodes.json > static/topojson/zipregions.json");
